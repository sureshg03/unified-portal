""""""

Unified Django settings combining CDOE LSC Portal and Student Admission PortalDjango settings for backend project.

"""

Generated by 'django-admin startproject' using Django 4.2.16.

from pathlib import Path

from datetime import timedeltaFor more information on this file, see

import oshttps://docs.djangoproject.com/en/4.2/topics/settings/



# Build paths inside the project like this: BASE_DIR / 'subdir'.For the full list of settings and their values, see

BASE_DIR = Path(__file__).resolve().parent.parenthttps://docs.djangoproject.com/en/4.2/ref/settings/

"""

# SECURITY WARNING: keep the secret key used in production secret!

SECRET_KEY = 'django-insecure-zq1qj^vfyywm&wa+c-4zks4_7pe(6-4%u49+410@^&xgyj!_j2'from pathlib import Path



# SECURITY WARNING: don't run with debug turned on in production!# Build paths inside the project like this: BASE_DIR / 'subdir'.

DEBUG = TrueBASE_DIR = Path(__file__).resolve().parent.parent



ALLOWED_HOSTS = ['testserver', 'localhost', '127.0.0.1', 'localhost:8000', '127.0.0.1:8000']

# Quick-start development settings - unsuitable for production

# Application definition - Combined apps from both projects# See https://docs.djangoproject.com/en/4.2/howto/deployment/checklist/

INSTALLED_APPS = [

    'django.contrib.admin',# SECURITY WARNING: keep the secret key used in production secret!

    'django.contrib.auth',SECRET_KEY = 'django-insecure-zq1qj^vfyywm&wa+c-4zks4_7pe(6-4%u49+410@^&xgyj!_j2'

    'django.contrib.contenttypes',

    'django.contrib.sessions',# SECURITY WARNING: don't run with debug turned on in production!

    'django.contrib.messages',DEBUG = True

    'django.contrib.staticfiles',

    'corsheaders',ALLOWED_HOSTS = ['testserver', 'localhost', '127.0.0.1']

    'rest_framework',

    'rest_framework.authtoken',

    # CDOE LSC Portal Apps# Application definition

    'lsc_auth',

    'portal',INSTALLED_APPS = [

    'admissions',    'django.contrib.admin',

    # Student Admission Portal Apps    'django.contrib.auth',

    'api',    'django.contrib.contenttypes',

]    'django.contrib.sessions',

    'django.contrib.messages',

MIDDLEWARE = [    'django.contrib.staticfiles',

    'corsheaders.middleware.CorsMiddleware',    'corsheaders',

    'django.middleware.security.SecurityMiddleware',    'rest_framework',

    'django.contrib.sessions.middleware.SessionMiddleware',    'lsc_auth',

    'django.middleware.common.CommonMiddleware',    'portal',

    'django.middleware.csrf.CsrfViewMiddleware',    'admissions',

    'django.contrib.auth.middleware.AuthenticationMiddleware',]

    'django.contrib.messages.middleware.MessageMiddleware',

    'django.middleware.clickjacking.XFrameOptionsMiddleware',MIDDLEWARE = [

]    'corsheaders.middleware.CorsMiddleware',

    'django.middleware.security.SecurityMiddleware',

ROOT_URLCONF = 'backend.urls'    'django.contrib.sessions.middleware.SessionMiddleware',

    'django.middleware.common.CommonMiddleware',

TEMPLATES = [    'django.middleware.csrf.CsrfViewMiddleware',

    {    'django.contrib.auth.middleware.AuthenticationMiddleware',

        'BACKEND': 'django.template.backends.django.DjangoTemplates',    'django.contrib.messages.middleware.MessageMiddleware',

        'DIRS': [],    'django.middleware.clickjacking.XFrameOptionsMiddleware',

        'APP_DIRS': True,]

        'OPTIONS': {

            'context_processors': [ROOT_URLCONF = 'backend.urls'

                'django.template.context_processors.debug',

                'django.template.context_processors.request',TEMPLATES = [

                'django.contrib.auth.context_processors.auth',    {

                'django.contrib.messages.context_processors.messages',        'BACKEND': 'django.template.backends.django.DjangoTemplates',

            ],        'DIRS': [],

        },        'APP_DIRS': True,

    },        'OPTIONS': {

]            'context_processors': [

                'django.template.context_processors.debug',

WSGI_APPLICATION = 'backend.wsgi.application'                'django.template.context_processors.request',

                'django.contrib.auth.context_processors.auth',

# Combined Database Configuration                'django.contrib.messages.context_processors.messages',

# Multiple databases for different purposes            ],

DATABASES = {        },

    # Default database for Django admin, sessions, and LSC users    },

    'default': {]

        'ENGINE': 'django.db.backends.mysql',

        'NAME': 'lsc_portal_db',  # LSC Portal database for LSC usersWSGI_APPLICATION = 'backend.wsgi.application'

        'USER': 'root',

        'PASSWORD': '',  # Your MySQL password

        'HOST': 'localhost',# Database

        'PORT': '3306',# https://docs.djangoproject.com/en/4.2/ref/settings/#databases

        'OPTIONS': {

            'charset': 'utf8mb4',# SQLite (commented out)

            'collation': 'utf8mb4_unicode_ci',# DATABASES = {

        },#     'default': {

    },#         'ENGINE': 'django.db.backends.sqlite3',

    # Secondary database for Student Admission Portal and admin authentication#         'NAME': BASE_DIR / 'db.sqlite3',

    'online_edu': {#     }

        'ENGINE': 'django.db.backends.mysql',# }

        'NAME': 'online_edu',  # Online education database for admins and student admissions

        'USER': 'root',# MySQL Database Configuration - Triple Database Setup

        'PASSWORD': '',  # Your MySQL passwordDATABASES = {

        'HOST': 'localhost',    # Default database for Django admin, sessions, and LSC users

        'PORT': '3306',    'default': {

        'OPTIONS': {        'ENGINE': 'django.db.backends.mysql',

            'charset': 'utf8mb4',        'NAME': 'lsc_portal_db',  # LSC Portal database for LSC users

            'init_command': "SET sql_mode='STRICT_TRANS_TABLES'",        'USER': 'root',

        },        'PASSWORD': '',  # Your MySQL password

    },        'HOST': 'localhost',

    # Admin database for portal app (ApplicationSettings, etc)        'PORT': '3306',

    'lsc_admindb': {        'OPTIONS': {

        'ENGINE': 'django.db.backends.mysql',            'charset': 'utf8mb4',

        'NAME': 'lsc_admindb',  # Admin database for portal models            'collation': 'utf8mb4_unicode_ci',

        'USER': 'root',        },

        'PASSWORD': '',  # Your MySQL password    },

        'HOST': 'localhost',    # Secondary database for admin authentication

        'PORT': '3306',    'online_edu': {

        'OPTIONS': {        'ENGINE': 'django.db.backends.mysql',

            'charset': 'utf8mb4',        'NAME': 'online_edu',  # Online education database for admins

            'collation': 'utf8mb4_unicode_ci',        'USER': 'root',

        },        'PASSWORD': '',  # Your MySQL password

    }        'HOST': 'localhost',

}        'PORT': '3306',

        'OPTIONS': {

# Database Router - Routes LSCAdmin to online_edu and LSCUser to default            'charset': 'utf8mb4',

DATABASE_ROUTERS = ['backend.db_router.LSCDatabaseRouter']            'collation': 'utf8mb4_unicode_ci',

        },

# Password validation    },

AUTH_PASSWORD_VALIDATORS = [    # Admin database for portal app (ApplicationSettings, etc)

    {    'lsc_admindb': {

        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',        'ENGINE': 'django.db.backends.mysql',

    },        'NAME': 'lsc_admindb',  # Admin database for portal models

    {        'USER': 'root',

        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',        'PASSWORD': '',  # Your MySQL password

    },        'HOST': 'localhost',

    {        'PORT': '3306',

        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',        'OPTIONS': {

    },            'charset': 'utf8mb4',

    {            'collation': 'utf8mb4_unicode_ci',

        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',        },

    },    }

]}



# Internationalization# Database Router - Routes LSCAdmin to online_edu and LSCUser to default

LANGUAGE_CODE = 'en-us'DATABASE_ROUTERS = ['backend.db_router.LSCDatabaseRouter']

TIME_ZONE = 'UTC'

USE_I18N = True# Temporarily using SQLite to dump data

USE_TZ = True# DATABASES = {

#     'default': {

# Static files (CSS, JavaScript, Images)#         'ENGINE': 'django.db.backends.sqlite3',

STATIC_URL = 'static/'#         'NAME': BASE_DIR / 'db.sqlite3',

#     }

# Media files configuration (for Student Admission Portal)# }

MEDIA_URL = '/media/'

MEDIA_ROOT = os.path.join(BASE_DIR, 'media')

# Password validation

# Default primary key field type# https://docs.djangoproject.com/en/4.2/ref/settings/#auth-password-validators

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

AUTH_PASSWORD_VALIDATORS = [

# Custom authentication backends - Dual Database Authentication    {

AUTHENTICATION_BACKENDS = [        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',

    'lsc_auth.auth_backend.DualDatabaseAuthBackend',  # Master: Checks both databases    },

    'django.contrib.auth.backends.ModelBackend',  # Fallback: Default Django auth    {

]        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',

    },

# REST Framework Configuration    {

REST_FRAMEWORK = {        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',

    'DEFAULT_AUTHENTICATION_CLASSES': [    },

        'lsc_auth.authentication.LSCJWTAuthentication',    {

        'rest_framework.authentication.TokenAuthentication',        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',

        'rest_framework.authentication.SessionAuthentication',    },

        'rest_framework.authentication.BasicAuthentication',]

    ],

    'DEFAULT_PERMISSION_CLASSES': [

        'rest_framework.permissions.IsAuthenticated',# Internationalization

    ],# https://docs.djangoproject.com/en/4.2/topics/i18n/

}

LANGUAGE_CODE = 'en-us'

# JWT Settings for Secure Authentication (CDOE LSC Portal)

SIMPLE_JWT = {TIME_ZONE = 'UTC'

    'ACCESS_TOKEN_LIFETIME': timedelta(hours=2),

    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),USE_I18N = True

    'ROTATE_REFRESH_TOKENS': True,

    'BLACKLIST_AFTER_ROTATION': True,USE_TZ = True

    'UPDATE_LAST_LOGIN': True,

    

    'ALGORITHM': 'HS256',# Static files (CSS, JavaScript, Images)

    'SIGNING_KEY': SECRET_KEY,# https://docs.djangoproject.com/en/4.2/howto/static-files/

    'VERIFYING_KEY': None,

    'AUDIENCE': None,STATIC_URL = 'static/'

    'ISSUER': 'lsc-portal',

    # Default primary key field type

    'AUTH_HEADER_TYPES': ('Bearer',),# https://docs.djangoproject.com/en/4.2/ref/settings/#default-auto-field

    'AUTH_HEADER_NAME': 'HTTP_AUTHORIZATION',

    'USER_ID_FIELD': 'id',DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

    'USER_ID_CLAIM': 'user_id',

    # Custom authentication backends - Dual Database Authentication

    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),# Checks both online_edu.lsc_admins AND lsc_portal_db.lsc_auth_lscuser

    'TOKEN_TYPE_CLAIM': 'token_type',AUTHENTICATION_BACKENDS = [

    'JTI_CLAIM': 'jti',    'lsc_auth.auth_backend.DualDatabaseAuthBackend',  # Master: Checks both databases

        'django.contrib.auth.backends.ModelBackend',  # Fallback: Default Django auth

    'TOKEN_USER_CLASS': 'lsc_auth.models.LSCUser',]

}

REST_FRAMEWORK = {

# CORS Configuration - Combined from both projects    'DEFAULT_AUTHENTICATION_CLASSES': [

CORS_ALLOW_ALL_ORIGINS = True        'lsc_auth.authentication.LSCJWTAuthentication',

CORS_ALLOW_CREDENTIALS = True        'rest_framework.authentication.SessionAuthentication',

CORS_ALLOWED_ORIGINS = [        'rest_framework.authentication.BasicAuthentication',

    'http://localhost:3000',  # React default port    ],

    'http://localhost:5173',  # Vite default port    'DEFAULT_PERMISSION_CLASSES': [

    'http://127.0.0.1:5173',        'rest_framework.permissions.IsAuthenticated',

    'http://localhost:5175',  # Alternative Vite port    ],

    'http://127.0.0.1:5175',}

    'http://localhost:8081',  # Alternative port

    'http://127.0.0.1:8081',# JWT Settings for Secure Authentication

]from datetime import timedelta



CORS_ALLOW_METHODS = [SIMPLE_JWT = {

    'DELETE',    'ACCESS_TOKEN_LIFETIME': timedelta(hours=2),  # Access token expires in 2 hours

    'GET',    'REFRESH_TOKEN_LIFETIME': timedelta(days=7),  # Refresh token expires in 7 days

    'OPTIONS',    'ROTATE_REFRESH_TOKENS': True,  # Generate new refresh token on refresh

    'PATCH',    'BLACKLIST_AFTER_ROTATION': True,  # Blacklist old refresh tokens

    'POST',    'UPDATE_LAST_LOGIN': True,  # Update last_login field on token generation

    'PUT',    

]    'ALGORITHM': 'HS256',

    'SIGNING_KEY': SECRET_KEY,

CORS_ALLOW_HEADERS = [    'VERIFYING_KEY': None,

    'accept',    'AUDIENCE': None,

    'accept-encoding',    'ISSUER': 'lsc-portal',

    'authorization',    

    'content-type',    'AUTH_HEADER_TYPES': ('Bearer',),

    'dnt',    'AUTH_HEADER_NAME': 'HTTP_AUTHORIZATION',

    'origin',    'USER_ID_FIELD': 'id',

    'user-agent',    'USER_ID_CLAIM': 'user_id',

    'x-csrftoken',    

    'x-requested-with',    'AUTH_TOKEN_CLASSES': ('rest_framework_simplejwt.tokens.AccessToken',),

]    'TOKEN_TYPE_CLAIM': 'token_type',

    

# Email Configuration (Student Admission Portal)    'JTI_CLAIM': 'jti',

EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend'    

EMAIL_HOST = 'smtp.gmail.com'    # Custom claims

EMAIL_PORT = 587    'TOKEN_USER_CLASS': 'lsc_auth.models.LSCUser',

EMAIL_USE_TLS = True}

EMAIL_HOST_USER = 'periyaruniversity08@gmail.com'

EMAIL_HOST_PASSWORD = 'wafl azrs ldjv eeyt'CORS_ALLOWED_ORIGINS = [

DEFAULT_FROM_EMAIL = EMAIL_HOST_USER    "http://localhost:5173",  # Vite dev server

    "http://127.0.0.1:5173",

# Payment Gateway Configuration (Student Admission Portal)    "http://localhost:5175",  # Current Vite port

try:    "http://127.0.0.1:5175",

    from decouple import config    "http://localhost:8081",  # Alternative Vite port

        "http://127.0.0.1:8081",

    # Razorpay Configuration    # Add production URL when deployed

    RAZORPAY_KEY_ID = config('RAZORPAY_KEY_ID', default='rzp_test_phCnHzNiGNxEc9')]

    RAZORPAY_KEY_SECRET = config('RAZORPAY_KEY_SECRET', default='i837TRYWlZrLq4JTSTpGNx0q')

    CORS_ALLOW_CREDENTIALS = True

    # Paytm ConfigurationCORS_ALLOW_METHODS = [

    PAYTM_ENVIRONMENT = config('PAYTM_ENVIRONMENT', default='PROD')    'DELETE',

    PAYTM_MERCHANT_KEY = config('PAYTM_MERCHANT_KEY', default="")    'GET',

    PAYTM_MERCHANT_MID = config('PAYTM_MERCHANT_MID', default="")    'OPTIONS',

        'PATCH',

    if PAYTM_ENVIRONMENT == 'PROD':    'POST',

        PAYTM_MERCHANT_WEBSITE = config('PAYTM_MERCHANT_WEBSITE', default='DEFAULT')    'PUT',

        PAYTM_TXN_URL = config('PAYTM_TXN_URL', default='https://securegw.paytm.in/order/process')]

        PAYTM_STATUS_QUERY_URL = config('PAYTM_STATUS_QUERY_URL', default='https://securegw.paytm.in/v3/order/status')CORS_ALLOW_HEADERS = [

        PAYTM_REFUND_URL = config('PAYTM_REFUND_URL', default='https://securegw.paytm.in/refund/HANDLER_INTERNAL/REFUND')    'accept',

    else:    'accept-encoding',

        PAYTM_MERCHANT_WEBSITE = config('PAYTM_MERCHANT_WEBSITE', default='WEBSTAGING')    'authorization',

        PAYTM_TXN_URL = config('PAYTM_TXN_URL', default='https://securegw-stage.paytm.in/order/process')    'content-type',

        PAYTM_STATUS_QUERY_URL = config('PAYTM_STATUS_QUERY_URL', default='https://securegw-stage.paytm.in/v3/order/status')    'dnt',

        PAYTM_REFUND_URL = config('PAYTM_REFUND_URL', default='https://securegw-stage.paytm.in/refund/HANDLER_INTERNAL/REFUND')    'origin',

        'user-agent',

    PAYTM_CALLBACK_URL = config('PAYTM_CALLBACK_URL', default='http://localhost:8000/api/pgResponse/')    'x-csrftoken',

except ImportError:    'x-requested-with',

    # Fallback if decouple is not installed]

    RAZORPAY_KEY_ID = 'rzp_test_phCnHzNiGNxEc9'
    RAZORPAY_KEY_SECRET = 'i837TRYWlZrLq4JTSTpGNx0q'
    PAYTM_ENVIRONMENT = 'PROD'
    PAYTM_MERCHANT_KEY = ""
    PAYTM_MERCHANT_MID = ""
    PAYTM_MERCHANT_WEBSITE = 'DEFAULT'
    PAYTM_TXN_URL = 'https://securegw.paytm.in/order/process'
    PAYTM_STATUS_QUERY_URL = 'https://securegw.paytm.in/v3/order/status'
    PAYTM_REFUND_URL = 'https://securegw.paytm.in/refund/HANDLER_INTERNAL/REFUND'
    PAYTM_CALLBACK_URL = 'http://localhost:8000/api/pgResponse/'

# Google Drive Configuration (Student Admission Portal)
GOOGLE_DRIVE_CREDENTIALS_FILE = 'credentials/application-form-461801-5f596cf183b9.json'
